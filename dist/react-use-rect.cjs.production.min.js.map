{"version":3,"file":"react-use-rect.cjs.production.min.js","sources":["../src/useRect.ts","../src/useRerender.ts"],"sourcesContent":["import { ResizeObserver } from '@juggle/resize-observer';\nimport equal from 'fast-deep-equal';\nimport { useRef, useCallback, useEffect, useLayoutEffect } from 'react';\nimport { useRerender } from './useRerender';\n\nexport interface Rect {\n  bottom: number;\n  height: number;\n  left: number;\n  right: number;\n  top: number;\n  width: number;\n  x: number;\n  y: number;\n}\n\nconst IS_SSR = typeof window === 'undefined';\n\nconst useIsomorphicEffect = IS_SSR ? useEffect : useLayoutEffect;\n\nconst GLOBAL_EVENTS = ['resize', 'scroll', 'transitionend'];\nconst GLOBAL_EVENT_CONFIG = {\n  capture: true,\n  passive: true\n};\n\nconst DEFAULT_RECT: Rect = {\n  bottom: 0,\n  height: 0,\n  left: 0,\n  right: 0,\n  top: 0,\n  width: 0,\n  x: 0,\n  y: 0\n};\n\nexport function useRect() {\n  const resizeObserverRef = useRef<ResizeObserver>();\n  const targetElementRef = useRef<Element>();\n  const rectRef = useRef(DEFAULT_RECT);\n\n  const rerender = useRerender();\n\n  const updateRect = useCallback(() => {\n    if (!targetElementRef.current) {\n      if (rectRef.current !== DEFAULT_RECT) {\n        rectRef.current = DEFAULT_RECT;\n        rerender();\n      }\n\n      return;\n    }\n\n    const clientRect = targetElementRef.current.getBoundingClientRect();\n    const nextRect = {\n      bottom: clientRect.bottom,\n      height: clientRect.height,\n      left: clientRect.left,\n      right: clientRect.right,\n      top: clientRect.top,\n      width: clientRect.width,\n      x: clientRect.x,\n      y: clientRect.y\n    };\n\n    if (!equal(rectRef.current, nextRect)) {\n      rectRef.current = nextRect;\n      rerender();\n    }\n  }, [rerender]);\n\n  const targetElementCallbackRef = useCallback(\n    (targetElement: Element | null) => {\n      targetElementRef.current = targetElement ?? undefined;\n\n      if (resizeObserverRef.current) {\n        resizeObserverRef.current.disconnect();\n        resizeObserverRef.current = undefined;\n      }\n\n      if (targetElementRef.current) {\n        resizeObserverRef.current = new ResizeObserver(updateRect);\n        resizeObserverRef.current.observe(targetElementRef.current);\n      }\n    },\n    [updateRect]\n  );\n\n  useIsomorphicEffect(() => {\n    if (IS_SSR) {\n      return undefined;\n    }\n\n    const globalEventListener = () => updateRect();\n\n    GLOBAL_EVENTS.forEach((eventType) => {\n      window.addEventListener(\n        eventType,\n        globalEventListener,\n        GLOBAL_EVENT_CONFIG\n      );\n    });\n\n    return () => {\n      GLOBAL_EVENTS.forEach((eventType) => {\n        window.removeEventListener(\n          eventType,\n          globalEventListener,\n          GLOBAL_EVENT_CONFIG\n        );\n      });\n    };\n  }, [updateRect]);\n\n  useIsomorphicEffect(updateRect);\n\n  return [targetElementCallbackRef, rectRef.current] as [\n    (targetElement: Element | null) => void,\n    Rect\n  ];\n}\n","import { useState, useCallback } from 'react';\n\nexport function useRerender() {\n  const [, rerender] = useState({});\n  return useCallback(() => rerender({}), []);\n}\n"],"names":["IS_SSR","window","useIsomorphicEffect","useEffect","useLayoutEffect","GLOBAL_EVENTS","GLOBAL_EVENT_CONFIG","capture","passive","DEFAULT_RECT","bottom","height","left","right","top","width","x","y","resizeObserverRef","useRef","targetElementRef","rectRef","rerender","useState","useCallback","useRerender","updateRect","current","clientRect","getBoundingClientRect","nextRect","equal","targetElementCallbackRef","targetElement","undefined","disconnect","ResizeObserver","observe","globalEventListener","forEach","eventType","addEventListener","removeEventListener"],"mappings":"kNAgBMA,EAA2B,oBAAXC,OAEhBC,EAAsBF,EAASG,YAAYC,kBAE3CC,EAAgB,CAAC,SAAU,SAAU,iBACrCC,EAAsB,CAC1BC,SAAS,EACTC,SAAS,GAGLC,EAAqB,CACzBC,OAAQ,EACRC,OAAQ,EACRC,KAAM,EACNC,MAAO,EACPC,IAAK,EACLC,MAAO,EACPC,EAAG,EACHC,EAAG,mBAGL,eACQC,EAAoBC,WACpBC,EAAmBD,WACnBE,EAAUF,SAAOV,GAEjBa,iBCvCGA,EAAYC,WAAS,cACvBC,eAAY,kBAAMF,EAAS,MAAK,IDsCtBG,GAEXC,EAAaF,eAAY,cACxBJ,EAAiBO,aAShBC,EAAaR,EAAiBO,QAAQE,wBACtCC,EAAW,CACfpB,OAAQkB,EAAWlB,OACnBC,OAAQiB,EAAWjB,OACnBC,KAAMgB,EAAWhB,KACjBC,MAAOe,EAAWf,MAClBC,IAAKc,EAAWd,IAChBC,MAAOa,EAAWb,MAClBC,EAAGY,EAAWZ,EACdC,EAAGW,EAAWX,GAGXc,EAAMV,EAAQM,QAASG,KAC1BT,EAAQM,QAAUG,EAClBR,UAtBID,EAAQM,UAAYlB,IACtBY,EAAQM,QAAUlB,EAClBa,OAsBH,CAACA,IAEEU,EAA2BR,eAC/B,SAACS,GACCb,EAAiBO,QAAUM,MAAAA,EAAAA,OAAiBC,EAExChB,EAAkBS,UACpBT,EAAkBS,QAAQQ,aAC1BjB,EAAkBS,aAAUO,GAG1Bd,EAAiBO,UACnBT,EAAkBS,QAAU,IAAIS,iBAAeV,GAC/CR,EAAkBS,QAAQU,QAAQjB,EAAiBO,YAGvD,CAACD,WAGHxB,GAAoB,eACdF,OAIEsC,EAAsB,kBAAMZ,YAElCrB,EAAckC,SAAQ,SAACC,GACrBvC,OAAOwC,iBACLD,EACAF,EACAhC,MAIG,WACLD,EAAckC,SAAQ,SAACC,GACrBvC,OAAOyC,oBACLF,EACAF,EACAhC,UAIL,CAACoB,IAEJxB,EAAoBwB,GAEb,CAACM,EAA0BX,EAAQM"}