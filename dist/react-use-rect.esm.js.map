{"version":3,"file":"react-use-rect.esm.js","sources":["../src/useRerender.ts","../src/useRect.ts"],"sourcesContent":["import { useState, useCallback } from 'react';\n\nexport function useRerender() {\n  const [, rerender] = useState({});\n  return useCallback(() => rerender({}), []);\n}\n","import { ResizeObserver } from '@juggle/resize-observer';\nimport equal from 'fast-deep-equal';\nimport { useRef, useCallback, useEffect, useLayoutEffect } from 'react';\nimport { useRerender } from './useRerender';\n\nexport interface Rect {\n  bottom: number;\n  height: number;\n  left: number;\n  right: number;\n  top: number;\n  width: number;\n  x: number;\n  y: number;\n}\n\nconst IS_SSR = typeof window === 'undefined';\n\nconst useIsomorphicEffect = IS_SSR ? useEffect : useLayoutEffect;\n\nconst GLOBAL_EVENTS = ['resize', 'scroll', 'transitionend'];\nconst GLOBAL_EVENT_CONFIG = {\n  capture: true,\n  passive: true\n};\n\nconst DEFAULT_RECT: Rect = {\n  bottom: 0,\n  height: 0,\n  left: 0,\n  right: 0,\n  top: 0,\n  width: 0,\n  x: 0,\n  y: 0\n};\n\nexport function useRect() {\n  const resizeObserverRef = useRef<ResizeObserver>();\n  const targetElementRef = useRef<Element>();\n  const rectRef = useRef(DEFAULT_RECT);\n\n  const rerender = useRerender();\n\n  const updateRect = useCallback(() => {\n    if (!targetElementRef.current) {\n      if (rectRef.current !== DEFAULT_RECT) {\n        rectRef.current = DEFAULT_RECT;\n        rerender();\n      }\n\n      return;\n    }\n\n    const clientRect = targetElementRef.current.getBoundingClientRect();\n    const nextRect = {\n      bottom: clientRect.bottom,\n      height: clientRect.height,\n      left: clientRect.left,\n      right: clientRect.right,\n      top: clientRect.top,\n      width: clientRect.width,\n      x: clientRect.x,\n      y: clientRect.y\n    };\n\n    if (!equal(rectRef.current, nextRect)) {\n      rectRef.current = nextRect;\n      rerender();\n    }\n  }, [rerender]);\n\n  const targetElementCallbackRef = useCallback(\n    (targetElement: Element | null) => {\n      targetElementRef.current = targetElement ?? undefined;\n\n      if (resizeObserverRef.current) {\n        resizeObserverRef.current.disconnect();\n        resizeObserverRef.current = undefined;\n      }\n\n      if (targetElementRef.current) {\n        resizeObserverRef.current = new ResizeObserver(updateRect);\n        resizeObserverRef.current.observe(targetElementRef.current);\n      }\n    },\n    [updateRect]\n  );\n\n  useIsomorphicEffect(() => {\n    if (IS_SSR) {\n      return undefined;\n    }\n\n    const globalEventListener = () => updateRect();\n\n    GLOBAL_EVENTS.forEach((eventType) => {\n      window.addEventListener(\n        eventType,\n        globalEventListener,\n        GLOBAL_EVENT_CONFIG\n      );\n    });\n\n    return () => {\n      GLOBAL_EVENTS.forEach((eventType) => {\n        window.removeEventListener(\n          eventType,\n          globalEventListener,\n          GLOBAL_EVENT_CONFIG\n        );\n      });\n    };\n  }, [updateRect]);\n\n  useIsomorphicEffect(updateRect);\n\n  return [targetElementCallbackRef, rectRef.current] as [\n    (targetElement: Element | null) => void,\n    Rect\n  ];\n}\n"],"names":["useRerender","useState","rerender","useCallback","IS_SSR","window","useIsomorphicEffect","useEffect","useLayoutEffect","GLOBAL_EVENTS","GLOBAL_EVENT_CONFIG","capture","passive","DEFAULT_RECT","bottom","height","left","right","top","width","x","y","useRect","resizeObserverRef","useRef","targetElementRef","rectRef","updateRect","current","clientRect","getBoundingClientRect","nextRect","equal","targetElementCallbackRef","targetElement","undefined","disconnect","ResizeObserver","observe","globalEventListener","forEach","eventType","addEventListener","removeEventListener"],"mappings":";;;;SAEgBA;kBACOC,QAAQ,CAAC,EAAD;MAApBC;;AACT,SAAOC,WAAW,CAAC;AAAA,WAAMD,QAAQ,CAAC,EAAD,CAAd;AAAA,GAAD,EAAqB,EAArB,CAAlB;AACD;;ACWD,IAAME,MAAM,GAAG,OAAOC,MAAP,KAAkB,WAAjC;AAEA,IAAMC,mBAAmB,GAAGF,MAAM,GAAGG,SAAH,GAAeC,eAAjD;AAEA,IAAMC,aAAa,GAAG,CAAC,QAAD,EAAW,QAAX,EAAqB,eAArB,CAAtB;AACA,IAAMC,mBAAmB,GAAG;AAC1BC,EAAAA,OAAO,EAAE,IADiB;AAE1BC,EAAAA,OAAO,EAAE;AAFiB,CAA5B;AAKA,IAAMC,YAAY,GAAS;AACzBC,EAAAA,MAAM,EAAE,CADiB;AAEzBC,EAAAA,MAAM,EAAE,CAFiB;AAGzBC,EAAAA,IAAI,EAAE,CAHmB;AAIzBC,EAAAA,KAAK,EAAE,CAJkB;AAKzBC,EAAAA,GAAG,EAAE,CALoB;AAMzBC,EAAAA,KAAK,EAAE,CANkB;AAOzBC,EAAAA,CAAC,EAAE,CAPsB;AAQzBC,EAAAA,CAAC,EAAE;AARsB,CAA3B;AAWA,SAAgBC;AACd,MAAMC,iBAAiB,GAAGC,MAAM,EAAhC;AACA,MAAMC,gBAAgB,GAAGD,MAAM,EAA/B;AACA,MAAME,OAAO,GAAGF,MAAM,CAACX,YAAD,CAAtB;AAEA,MAAMX,QAAQ,GAAGF,WAAW,EAA5B;AAEA,MAAM2B,UAAU,GAAGxB,WAAW,CAAC;AAC7B,QAAI,CAACsB,gBAAgB,CAACG,OAAtB,EAA+B;AAC7B,UAAIF,OAAO,CAACE,OAAR,KAAoBf,YAAxB,EAAsC;AACpCa,QAAAA,OAAO,CAACE,OAAR,GAAkBf,YAAlB;AACAX,QAAAA,QAAQ;AACT;;AAED;AACD;;AAED,QAAM2B,UAAU,GAAGJ,gBAAgB,CAACG,OAAjB,CAAyBE,qBAAzB,EAAnB;AACA,QAAMC,QAAQ,GAAG;AACfjB,MAAAA,MAAM,EAAEe,UAAU,CAACf,MADJ;AAEfC,MAAAA,MAAM,EAAEc,UAAU,CAACd,MAFJ;AAGfC,MAAAA,IAAI,EAAEa,UAAU,CAACb,IAHF;AAIfC,MAAAA,KAAK,EAAEY,UAAU,CAACZ,KAJH;AAKfC,MAAAA,GAAG,EAAEW,UAAU,CAACX,GALD;AAMfC,MAAAA,KAAK,EAAEU,UAAU,CAACV,KANH;AAOfC,MAAAA,CAAC,EAAES,UAAU,CAACT,CAPC;AAQfC,MAAAA,CAAC,EAAEQ,UAAU,CAACR;AARC,KAAjB;;AAWA,QAAI,CAACW,KAAK,CAACN,OAAO,CAACE,OAAT,EAAkBG,QAAlB,CAAV,EAAuC;AACrCL,MAAAA,OAAO,CAACE,OAAR,GAAkBG,QAAlB;AACA7B,MAAAA,QAAQ;AACT;AACF,GA1B6B,EA0B3B,CAACA,QAAD,CA1B2B,CAA9B;AA4BA,MAAM+B,wBAAwB,GAAG9B,WAAW,CAC1C,UAAC+B,aAAD;AACET,IAAAA,gBAAgB,CAACG,OAAjB,GAA2BM,aAA3B,aAA2BA,aAA3B,cAA2BA,aAA3B,GAA4CC,SAA5C;;AAEA,QAAIZ,iBAAiB,CAACK,OAAtB,EAA+B;AAC7BL,MAAAA,iBAAiB,CAACK,OAAlB,CAA0BQ,UAA1B;AACAb,MAAAA,iBAAiB,CAACK,OAAlB,GAA4BO,SAA5B;AACD;;AAED,QAAIV,gBAAgB,CAACG,OAArB,EAA8B;AAC5BL,MAAAA,iBAAiB,CAACK,OAAlB,GAA4B,IAAIS,cAAJ,CAAmBV,UAAnB,CAA5B;AACAJ,MAAAA,iBAAiB,CAACK,OAAlB,CAA0BU,OAA1B,CAAkCb,gBAAgB,CAACG,OAAnD;AACD;AACF,GAbyC,EAc1C,CAACD,UAAD,CAd0C,CAA5C;AAiBArB,EAAAA,mBAAmB,CAAC;AAClB,QAAIF,MAAJ,EAAY;AACV,aAAO+B,SAAP;AACD;;AAED,QAAMI,mBAAmB,GAAG,SAAtBA,mBAAsB;AAAA,aAAMZ,UAAU,EAAhB;AAAA,KAA5B;;AAEAlB,IAAAA,aAAa,CAAC+B,OAAd,CAAsB,UAACC,SAAD;AACpBpC,MAAAA,MAAM,CAACqC,gBAAP,CACED,SADF,EAEEF,mBAFF,EAGE7B,mBAHF;AAKD,KAND;AAQA,WAAO;AACLD,MAAAA,aAAa,CAAC+B,OAAd,CAAsB,UAACC,SAAD;AACpBpC,QAAAA,MAAM,CAACsC,mBAAP,CACEF,SADF,EAEEF,mBAFF,EAGE7B,mBAHF;AAKD,OAND;AAOD,KARD;AASD,GAxBkB,EAwBhB,CAACiB,UAAD,CAxBgB,CAAnB;AA0BArB,EAAAA,mBAAmB,CAACqB,UAAD,CAAnB;AAEA,SAAO,CAACM,wBAAD,EAA2BP,OAAO,CAACE,OAAnC,CAAP;AAID;;;;"}